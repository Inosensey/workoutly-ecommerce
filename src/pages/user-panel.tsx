import Head from "next/head";
import { useEffect, useState } from "react";
import { useSelector } from "react-redux";
import AccessForbidden from "../modules/403/AccessForbidden";
import Content from "../modules/UserPanel/Content";
import Sidebar from "../modules/UserPanel/Sidebar";
import { RootState } from "../Redux/store";

export const UserPanel = () => {
  const Session: any =
    useSelector((state: RootState) => state.AuthReducer.Session) || {};
  const [isMobile, setIsMobile] = useState<boolean>(false);
  const [showSidebar, setShowSidebar] = useState<boolean>(true);
  const handleResize = () => {
    let mobile = false;
    if (window.innerWidth <= 769 && mobile === false) {
      mobile = true;
    }
    if (window.innerWidth > 769 && mobile === true) {
      mobile = false;
    }
    setShowSidebar(mobile ? false : true);
    setIsMobile(mobile);
    return mobile;
  };
  useEffect(() => {
    window.addEventListener("resize", handleResize);
    handleResize();
    return () => window.removeEventListener("resize", handleResize);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  return (
    <div>
      <Head>
        <title>Workoutly Ecommerce</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="shortcut icon" href="/Logo.ico" type="image/x-icon" />
      </Head>
      <main style={{ display: "flex", width: "100%", height: "100vh" }}>
        {Session.Auth !== undefined ? (
          <>
            <Sidebar
              isMobile={isMobile}
              showSidebar={showSidebar}
              setShowSidebar={setShowSidebar}
            />
            <Content setShowSidebar={setShowSidebar} />
          </>
        ) : (
          <AccessForbidden />
        )}
      </main>
    </div>
  );
};

export default UserPanel;
