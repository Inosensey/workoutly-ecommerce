import Head from "next/head";
import React, { useEffect, useState } from "react";
import { useSelector } from "react-redux";
import AccessForbidden from "../modules/403/AccessForbidden";
import Content from "../modules/UserPanel/Content";
import Sidebar from "../modules/UserPanel/Sidebar";
import { RootState } from "../Redux/store";
import getPersonalDetails from "../Services/Supabase/getPersonalDetails";
import { supabase } from "../Services/Supabase/supabaseClient";

export const UserPanel = () => {
  const Session: any =
    useSelector((state: RootState) => state.AuthReducer.Session) || {};
  const [details, setDetails] = useState({});

  useEffect(() => {
    personalDetails();
  }, []);
  const personalDetails = async () => {
    supabase.auth.setAuth(Session.Auth.access_token);
    const response: any = await getPersonalDetails(Session.User.id);
    setDetails(response?.Data);
  };

  return (
    <div>
      <Head>
        <title>Workoutly Ecommerce</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="shortcut icon" href="/Logo.ico" type="image/x-icon" />
      </Head>
      <main style={{ display: "flex" }}>
        {Session.Auth !== undefined ? (
          <>
            <Sidebar />
            <Content />
          </>
        ) : (
          <AccessForbidden />
        )}
      </main>
    </div>
  );
};

export default UserPanel;
